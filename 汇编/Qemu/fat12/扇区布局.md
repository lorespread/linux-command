在软盘上使用 **FAT12** 文件系统时，其引导程序布局基本遵循 FAT12 的标准结构。由于软盘通常大小较小（例如 1.44 MB 的软盘），其结构比硬盘上的文件系统简单得多。

以下是 **FAT12 在软盘上的引导程序布局**：

---

### **软盘的常规参数**
假设使用 1.44 MB 的软盘，其标准参数如下：
- 每扇区字节数（`BPB_BytsPerSec`）：512 字节。
- 每簇扇区数（`BPB_SecPerClus`）：1。
- 保留扇区数（`BPB_RsvdSecCnt`）：1（即仅有引导扇区）。
- FAT 表数量（`BPB_NumFATs`）：2。
- 根目录条目数（`BPB_RootEntCnt`）：224。
- 每 FAT 表大小（`BPB_FATSz16`）：9 扇区。

#### **软盘扇区分布**
| 区域名称            | 起始扇区 | 扇区数量 | 描述                                                             |
|---------------------|----------|----------|------------------------------------------------------------------|
| **引导扇区**        | 0        | 1        | 引导代码及 FAT12 文件系统信息（BPB），通常包含 Stage 1 引导代码。 |
| **FAT 表 1**        | 1        | 9        | 第一张文件分配表，用于文件簇分配管理。                            |
| **FAT 表 2**        | 10       | 9        | 第二张文件分配表，冗余备份 FAT 表 1。                            |
| **根目录区域**      | 19       | 14       | 存储根目录条目（每条 32 字节，最多 224 条目）。                  |
| **数据区域（簇区域）** | 33       | N        | 文件和目录数据存储区域，分为簇进行管理。                          |

---

### **引导程序的布局与作用**
在软盘的 FAT12 文件系统中，**引导程序**主要放在第一个扇区（即 **引导扇区**），同时也可能利用数据区域存放额外的引导代码。

#### **引导扇区**
引导扇区是保留区域的第一个扇区，包含两个主要部分：
1. **BIOS 参数块（BPB）**：
   - 描述文件系统的结构信息，如扇区大小、FAT 表数量、根目录区域大小等。
   - 用于文件系统驱动程序正确解析软盘的文件系统。
2. **引导代码（Boot Code）**：
   - 通常为第一阶段引导加载程序（Stage 1）。
   - 完成以下任务：
     - 初始化必要的硬件（如设置段寄存器）。
     - 加载 Stage 2 引导程序（如果有）。
     - 转移控制权给操作系统或引导程序的下一个阶段。

#### **Stage 2 引导程序**
如果引导代码过大，超过一个扇区的大小（512 字节），可以将其拆分为多阶段：
- **Stage 1** 位于引导扇区。
- **Stage 2** 位于：
  - 数据区域的某个位置（通过固定地址加载）。
  - 或文件系统内存储的文件（通过解析 FAT 表和目录结构加载）。

---

### **FAT12 软盘引导程序工作流程**
1. **BIOS 加载引导扇区**：
   - 启动时，BIOS 将软盘的第 0 扇区（引导扇区）加载到内存 `0x7C00` 地址，并将控制权转移给它。
2. **Stage 1 执行**：
   - 设置段寄存器（如 `CS`、`DS`、`SS` 等）。
   - 根据需要加载 FAT 表和目录信息，找到 Stage 2 引导程序的位置。
   - 加载 Stage 2 到内存，并跳转执行。
3. **Stage 2 执行**：
   - 实现更复杂的功能，如加载操作系统内核或显示菜单。

---

### **示例：引导扇区的内容**
下面是一个简单的 FAT12 引导扇区示例，带有引导代码和文件系统的 BPB 信息：

```asm
org 0x7C00                 ; 引导扇区加载地址

; BIOS 参数块 (BPB)
jmp short Start            ; 跳过 BPB 的跳转指令
nop                        ; 保持对齐
db "FAT12   "              ; 文件系统类型标识
dw 512                     ; 每扇区字节数
db 1                       ; 每簇扇区数
dw 1                       ; 保留扇区数
db 2                       ; FAT 表数量
dw 224                     ; 根目录条目数
dw 2880                    ; 总扇区数 (1.44MB 软盘)
db 0xF0                    ; 媒体描述符 (软盘)
dw 9                       ; 每 FAT 表大小（扇区数）
dw 18                      ; 每磁道扇区数
dw 2                       ; 磁头数
dd 0                       ; 隐藏扇区数
dd 0                       ; 总扇区数 (大容量)

Start:
    ; 初始化段寄存器
    mov ax, 0x07C0
    mov ds, ax
    mov es, ax
    mov ss, ax
    mov sp, 0x7C00

    ; 显示消息
    mov si, Message
    call PrintString

    ; 无限循环
    jmp $

PrintString:
    mov ah, 0x0E           ; BIOS teletype 输出
PrintNextChar:
    lodsb                  ; 取下一个字符
    cmp al, 0
    je Done
    int 0x10
    jmp PrintNextChar
Done:
    ret

Message db "Hello from FAT12 Bootloader", 0

times 510-($-$$) db 0      ; 填充到 512 字节
dw 0xAA55                  ; 引导扇区签名
```

---

### **总结：**
- 在软盘的 FAT12 文件系统中，引导程序通常放在引导扇区（第 0 扇区）。
- Stage 2 引导程序可以存储在数据区域或文件系统的其他区域。
- BPB 定义了 FAT12 文件系统的结构信息，引导代码利用这些信息加载文件系统中的内容并完成引导任务。
