- [1 根目录区条目 32 字节是如何分配的](#1-根目录区条目-32-字节是如何分配的)
		- [32 字节的分配结构](#32-字节的分配结构)
		- [字段详细解释](#字段详细解释)
		- [总结](#总结)
- [2 根目录一般占用多少个簇](#2-根目录一般占用多少个簇)
	- [🔍 **根目录区占用簇数的计算公式：**](#-根目录区占用簇数的计算公式)
		- [📊 **基本参数：**](#-基本参数)
		- [📈 **计算根目录区所需的空间：**](#-计算根目录区所需的空间)
		- [📝 **总结：**](#-总结)
- [3 根目录占用扇区数公式](#3-根目录占用扇区数公式)
		- [**1. `BPB_RootEntCnt × 32`**](#1-bpb_rootentcnt--32)
		- [**2. `BPB_BytesPerSec`**](#2-bpb_bytespersec)
		- [**3. `+ BPB_BytesPerSec - 1` 的作用**](#3--bpb_bytespersec---1-的作用)
		- [**4. 为什么需要这个公式？**](#4-为什么需要这个公式)
		- [**总结公式计算流程**](#总结公式计算流程)
		- [**实际意义**](#实际意义)


# 1 根目录区条目 32 字节是如何分配的

在 FAT12 文件系统中，根目录区的每个条目确实占用 **32 字节**，这些字节被用于存储文件或目录的元数据。每个条目的结构如下：

### 32 字节的分配结构

| 偏移量 | 长度 (字节) | 字段名               | 说明                                                                 |
|--------|-------------|----------------------|----------------------------------------------------------------------|
| 0      | 8           | 文件名（8 字节）      | 文件的基本名称，最多 8 个字符，空格填充。按照 8.3 文件名格式存储。 |
| 8      | 3           | 扩展名（3 字节）      | 文件的扩展名，最多 3 个字符，空格填充。                             |
| 11     | 1           | 文件属性（1 字节）    | 文件的属性标志。每个位表示不同的属性。                               |
| 12     | 1           | 保留（1 字节）        | 保留字段，通常为 0。                                                 |
| 13     | 2           | 创建时间（2 字节）    | 文件或目录的创建时间（精确到秒）。                                   |
| 15     | 2           | 创建日期（2 字节）    | 文件或目录的创建日期。                                               |
| 17     | 2           | 最后访问日期（2 字节）| 文件的最后访问日期。                                                 |
| 19     | 2           | 高 16 位的文件起始簇号（2 字节） | 文件或目录的起始簇号的高 16 位。                                       |
| 21     | 2           | 修改时间（2 字节）    | 文件或目录的最后修改时间。                                           |
| 23     | 2           | 修改日期（2 字节）    | 文件或目录的最后修改日期。                                           |
| 25     | 2           | 低 16 位的文件起始簇号（2 字节） | 文件或目录的起始簇号的低 16 位。                                       |
| 27     | 1           | 文件大小（4 字节）    | 文件大小，对于目录项，文件大小为 0。                                 |
| 31     | 1           | 未使用（1 字节）      | 用于对齐的字节。通常为 0。                                           |

### 字段详细解释

1. **文件名（8 字节）**：
   - 存储文件的基本名称（不含扩展名），如果文件名少于 8 个字符，则剩余部分用空格填充。
   
2. **扩展名（3 字节）**：
   - 存储文件的扩展名（最大 3 个字符），如果扩展名少于 3 字节，则剩余部分用空格填充。

3. **文件属性（1 字节）**：
   - 这是一个位字段，每个位代表文件的不同属性。常见的属性有：
     - `0x01`：只读文件
     - `0x02`：隐藏文件
     - `0x04`：系统文件
     - `0x08`：卷标文件
     - `0x10`：目录文件
     - `0x20`：归档文件
     
4. **保留（1 字节）**：
   - 这个字段是保留的，通常为 0。

5. **创建时间（2 字节）**：
   - 文件创建的时间，格式为 5 位的小时和分钟，精确到秒。格式是 `hh:mm:ss`，每个字段占一定的位数。

6. **创建日期（2 字节）**：
   - 文件创建的日期，格式为 `yyyy-mm-dd`，以特定的二进制格式存储。

7. **最后访问日期（2 字节）**：
   - 文件最后访问的日期，格式为 `yyyy-mm-dd`，以特定的二进制格式存储。

8. **高 16 位的文件起始簇号（2 字节）**：
   - 文件在磁盘上的起始簇号的高 16 位。此信息和起始簇号的低 16 位一起形成完整的簇号。

9. **修改时间（2 字节）**：
   - 文件最后修改的时间，格式为 `hh:mm:ss`，精确到秒。

10. **修改日期（2 字节）**：
    - 文件最后修改的日期，格式为 `yyyy-mm-dd`。

11. **低 16 位的文件起始簇号（2 字节）**：
    - 文件在磁盘上的起始簇号的低 16 位。

12. **文件大小（4 字节）**：
    - 对于文件，这个字段存储文件的字节大小；对于目录，这个字段是 0。

13. **未使用（1 字节）**：
    - 用于对齐字段，通常为 0。

### 总结

根目录区的每个条目总共 **32 字节**，其中包含文件的基本信息，如文件名、扩展名、属性、时间戳、文件大小、起始簇号等。这样每个条目就能够完整地描述一个文件或目录的信息。

# 2 根目录一般占用多少个簇

在 FAT12 文件系统中，**根目录区（Root Directory）** 的大小通常是固定的，并与磁盘结构有关。具体占用的簇数取决于以下几个因素：

---

## 🔍 **根目录区占用簇数的计算公式：**

### 📊 **基本参数：**
- 每个根目录项的大小：**32 字节**  
- FAT12 根目录最多可以容纳 **224 个条目**（即最多 224 个文件或目录）。
- 每个簇大小：通常为 **512 字节**。

---

### 📈 **计算根目录区所需的空间：**

1. **计算根目录区的总大小：**  
   根目录区的总空间为：
```math
   \text{总空间} = 224 \times 32 \, (\text{每个条目 32 字节}) = 7168 \, \text{字节}
```

2. **计算所需的簇数：**  
   每个簇为 **512 字节**，因此：
```math
   \text{簇数} = \lceil \frac{7168}{512} \rceil = \lceil 14 \rceil = 14 \, \text{簇}
```

---

### 📝 **总结：**
在 **FAT12 文件系统中**：

- 根目录区一般占用 **14 个簇**。
- 这个大小是固定的，并且在根目录区域的位置通常紧跟在 **FAT 表之后**。

---

📍 **注意：**  
- 根目录区的固定大小与磁盘容量和簇数有关。
- 在较小的磁盘（如软盘）上，根目录区可能更小，而在较大的磁盘上，这个固定大小并不会动态调整。  


# 3 根目录占用扇区数公式

为什么根目录占用的扇区数，要用 (BPB_RootEntCnt ＊ 32 +BPB_BytesPerSec -1) / BPB_Bytes PerSec 这个公式来计算

在 FAT12 文件系统中，根目录的大小是由根目录中最大支持的条目数决定的，根目录需要占用一定数量的扇区。公式：

```math
\text{扇区数} = \frac{(\text{BPB\_RootEntCnt} \times 32) + \text{BPB\_BytesPerSec} - 1}{\text{BPB\_BytesPerSec}}
```

解释每一部分的意义：

---

### **1. `BPB_RootEntCnt × 32`**
- **根目录条目数：**
  - `BPB_RootEntCnt` 是根目录条目的最大数量。每个条目固定为 **32 字节**（包含文件名、属性、大小等信息）。
  - 因此，整个根目录的大小（以字节为单位）是 `BPB_RootEntCnt × 32`。

---

### **2. `BPB_BytesPerSec`**
- **每扇区字节数：**
  - 一个扇区能存储的字节数，由 `BPB_BytesPerSec` 定义。通常是 **512 字节**。

- **分块存储：**
  - 根目录数据需要存储在连续的扇区中，因此要将总字节数（`BPB_RootEntCnt × 32`）除以每扇区字节数，得到所需的扇区数。

---

### **3. `+ BPB_BytesPerSec - 1` 的作用**
- **向上取整：**
  - 如果总字节数不能被 `BPB_BytesPerSec` 整除，则最后一个扇区可能未填满，但仍需要占用整个扇区。
  - 为了实现向上取整：
```math
    \text{向上取整公式} = \frac{\text{总字节数} + \text{每扇区字节数} - 1}{\text{每扇区字节数}}
```

  - 举例：
    - 假设 `BPB_RootEntCnt × 32 = 800` 字节，`BPB_BytesPerSec = 512`：
```math
      \frac{800 + 512 - 1}{512} = \frac{1311}{512} = 2\ \text{扇区（向上取整）}
```

---

### **4. 为什么需要这个公式？**
- 文件系统在物理存储中必须以扇区为单位分配空间，而根目录的大小由文件系统设计决定，可能无法刚好填满一个或多个扇区。这个公式确保了根目录的条目数能够分配到足够的连续扇区，而不会浪费或丢失空间。

---

### **总结公式计算流程**
1. 计算根目录需要的总字节数：`BPB_RootEntCnt × 32`。
2. 将字节数转化为扇区数，确保分配足够的扇区存储数据。
3. 用公式：
```math
\text{扇区数} = \frac{(\text{BPB\_RootEntCnt} \times 32) + \text{BPB\_BytesPerSec} - 1}{\text{BPB\_BytesPerSec}}
```
   确保即使最后一个扇区未填满，仍然会分配一个完整扇区。

---

### **实际意义**
在 FAT12 文件系统中，根目录的扇区数直接影响了系统分区结构的计算。通过这个公式，可以准确地为根目录分配所需的空间，同时保证不出现内存不足或过多浪费的情况。
