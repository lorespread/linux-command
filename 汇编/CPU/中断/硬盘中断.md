# 1 硬盘中断读取的数据存储到什么寄存器指定的位置

在使用 `INT 13h` 中断读取磁盘数据时，读取的数据并不会直接存储到 CPU 寄存器中，而是存储到内存中的指定缓冲区地址。缓冲区的起始地址通常通过段寄存器 (`ES`) 和偏移寄存器 (`BX`) 的组合来指定。

---

### **具体过程**
- 当你调用 `INT 13h` 进行磁盘读操作时，会使用以下寄存器来指定读取数据存储的内存位置：
  - **`ES` (段寄存器)**: 指定目标缓冲区的段地址。
  - **`BX` (偏移寄存器)**: 指定目标缓冲区的偏移地址。

数据读取后会被写入 `ES:BX` 指定的内存地址，而不是存储在某个 CPU 寄存器中。

---

### **如何指定缓冲区**
在调用 `INT 13h` 的前置操作中，程序会设置 `ES` 和 `BX` 的值，确保数据写入到目标缓冲区。例如：

```asm
mov ax, 0x0000      ; 段地址 0x0000
mov es, ax          ; 设置 ES 寄存器为 0x0000
mov bx, 0x8000      ; 偏移地址为 0x8000（缓冲区开始地址）

; 设置其他参数
mov ah, 0x02        ; 功能号：读扇区
mov al, 0x01        ; 要读取的扇区数
mov ch, 0x00        ; 柱面号
mov cl, 0x02        ; 扇区号
mov dh, 0x00        ; 磁头号
mov dl, 0x80        ; 驱动器号（0x80 表示第一个硬盘）

int 0x13            ; 调用中断服务
; 数据会被写入到 0x0000:0x8000 地址处
```

---

### **INT 13h 中断返回的数据**
1. **缓冲区内容**：
   - 调用成功后，读取的扇区数据会被存储到 `ES:BX` 指定的缓冲区。
   - 如果读取的扇区大小为 **512 字节**，那么 **`ES:BX`** 指向的地址范围会存储从扇区读取的 512 字节数据。

2. **返回状态**：
   - **AH**：返回状态码（例如，0 表示成功）。
   - 如果状态码不为 0，则表示读取失败，具体错误码可以参照 BIOS 文档。

---

### **缓冲区的意义**
- 缓冲区是读取数据后存储的内存区域。程序通过访问这个内存区域来解析或处理读取到的数据。
- 在读取多扇区时，可以重复使用相同的缓冲区，数据会被覆盖，确保内存利用效率。

---

### **总结**
- **INT 13h** 的数据存储目标是 `ES:BX` 指定的内存地址，而不是 CPU 寄存器。
- 开发者需要在调用中断前手动设置 `ES` 和 `BX`，确保数据存储到正确的位置。
- 示例中的 `mov ax, 0x0000` 和 `mov bx, 0x8000` 就是指定了一个常见的缓冲区地址。

# 2 详解硬盘中断的各种寄存器参数

`INT 13h` 是 BIOS 提供的磁盘服务中断，用于执行低级磁盘操作，如读取、写入或检测磁盘。调用 `INT 13h` 时，具体的功能和操作由相关寄存器的值决定。这些寄存器有明确的含义，决定了磁盘的操作方式和参数。

以下是 **`INT 13h` 磁盘服务中涉及的寄存器及其含义**：

---

### **常用寄存器及其含义**

| **寄存器** | **含义**                                                                                       |
|------------|------------------------------------------------------------------------------------------------|
| **AH**     | 指定磁盘服务功能号（如读取扇区、写入扇区、获取驱动器参数等）。                                  |
| **AL**     | 指定扇区数量（对于一些操作，例如读取或写入，表示要处理的扇区数）。                              |
| **CH**     | 指定柱面号的低 8 位（磁盘几何参数中的位置）。                                                   |
| **CL**     | 指定柱面号的高 2 位（前置 2 位）和扇区号的 6 位（扇区号从 1 开始，最大值为 63）。              |
| **DH**     | 指定磁头号（磁盘几何参数中的位置）。                                                           |
| **DL**     | 指定驱动器号（如 0x80 表示第一个硬盘，0x00 表示第一个软盘）。                                   |
| **ES:BX**  | 指定缓冲区地址（读取或写入数据时，指定数据在内存中的存储位置）。                                |

---

### **INT 13h 常见功能号 (AH)**

| **功能号 (AH)** | **描述**                                 | **使用寄存器**                              |
|------------------|------------------------------------------|---------------------------------------------|
| 0x00             | 复位磁盘系统                           | `DL`（驱动器号）。                          |
| 0x02             | 读取扇区                               | `AL`（扇区数）、`CH`、`CL`、`DH`、`DL`、`ES:BX`。 |
| 0x03             | 写入扇区                               | 同 `0x02`。                                 |
| 0x08             | 获取磁盘参数（几何信息）               | 返回磁盘几何参数到 `CH`、`CL`、`DH`、`DL`。 |
| 0x15             | 检测驱动器类型                         | `DL`（驱动器号），返回驱动器类型。           |

---

### **寄存器解释：几何参数**
磁盘操作中，寄存器中参数的设置需要符合磁盘的几何信息（CHS，即柱面、磁头、扇区）：

1. **`CH` 和 `CL`（柱面与扇区）**:
   - 磁盘以柱面 (Cylinder)、磁头 (Head)、扇区 (Sector) 的方式分区存储。
   - `CH` 存储柱面的低 8 位。
   - `CL` 的低 6 位存储扇区号（从 1 开始），高 2 位存储柱面的高 2 位。

2. **`DH`（磁头）**:
   - 表示当前操作所在的磁头编号，从 0 开始。

3. **`DL`（驱动器号）**:
   - 软盘：
     - 0x00 表示第一个软盘驱动器（通常是 `A:`）。
     - 0x01 表示第二个软盘驱动器（通常是 `B:`）。
   - 硬盘：
     - 0x80 表示第一个硬盘。
     - 0x81 表示第二个硬盘。

---

### **寄存器解释：缓冲区**
1. **`ES:BX`（缓冲区地址）**:
   - 数据读取后存储的位置或写入的数据源位置。
   - 由 `ES` 指定段地址，`BX` 指定偏移地址。
   - 程序需提前初始化 `ES` 和 `BX`，确保数据操作的正确位置。

---

### **示例代码**
#### 读取第一个硬盘的第一个扇区到内存地址 `0x0000:0x8000`：
```asm
mov ah, 0x02          ; 读取扇区功能
mov al, 0x01          ; 读取 1 个扇区
mov ch, 0x00          ; 柱面号 0（低 8 位）
mov cl, 0x01          ; 扇区号 1（注意从 1 开始）
mov dh, 0x00          ; 磁头号 0
mov dl, 0x80          ; 驱动器号 0x80，第一个硬盘

mov ax, 0x0000        ; 数据存储的段地址
mov es, ax            ; 设置段寄存器 ES
mov bx, 0x8000        ; 设置偏移地址 BX

int 0x13              ; 调用中断
jc ReadError          ; 如果 CF=1，则读取失败，跳转处理
```

---

### **INT 13h 调用后的寄存器状态**
- **成功返回**：
  - CF (Carry Flag) = 0。
  - 数据存储在 `ES:BX` 指定的缓冲区。
- **失败返回**：
  - CF = 1。
  - 错误码存储在 `AH`。

---

### **总结**
- `INT 13h` 使用的寄存器分为参数寄存器（如 `AH`、`AL`、`CH`、`CL`、`DH`、`DL`）和缓冲区地址寄存器（`ES:BX`）。
- 几何参数寄存器指定了磁盘的物理位置，而 `ES:BX` 指定了内存中数据的存放位置。
- 程序调用 `INT 13h` 前，需要正确初始化所有寄存器。

# 3 al 和 cl 寄存器对应的参数有什么区别

在 `INT 13h` 的磁盘操作中，`AL` 和 `CL` 是两个经常使用的寄存器，但它们的含义和用途不同：

---

### **1. `AL` 的含义**
- `AL` 用于指定**读取或写入的扇区数量**。
- 作用是告诉 BIOS 一次操作需要处理多少个扇区。
- 例如：
  - 如果 `AL = 1`，表示读取/写入 1 个扇区。
  - 如果 `AL = 3`，表示读取/写入连续的 3 个扇区。

---

### **2. `CL` 的含义**
- `CL` 的低 6 位用于指定**扇区号**（范围是 `1` 到 `63`）。
- `CL` 的高 2 位与 `CH` 一起用于指定**柱面号的高 2 位**。

#### **具体说明**
- **低 6 位（`CL[5:0]`）**：
  - 扇区号从 1 开始（不同于其他寄存器通常从 0 开始）。
  - 最大值为 `63`。
  - BIOS 使用这个值定位磁盘中的具体扇区。
  
- **高 2 位（`CL[7:6]`）**：
  - 用于表示柱面号的高 2 位。
  - 与 `CH`（柱面的低 8 位）一起构成完整的 10 位柱面号。

---

### **两者的主要区别**

| **寄存器** | **描述**                          | **作用范围**                                 |
|------------|-----------------------------------|---------------------------------------------|
| `AL`       | 扇区数量                          | 指定本次操作需要读取或写入的扇区个数。       |
| `CL`       | 扇区号（低 6 位） + 柱面号（高 2 位） | 指定开始操作的扇区（物理位置）。             |

---

### **示例代码**

#### 读取硬盘的第一个扇区：
```asm
mov ah, 0x02         ; 指定读取扇区功能
mov al, 0x01         ; 读取 1 个扇区
mov ch, 0x00         ; 柱面号（低 8 位），第 0 柱面
mov cl, 0x01         ; 扇区号为 1（从第 1 扇区开始）
mov dh, 0x00         ; 磁头号为 0（第 0 磁头）
mov dl, 0x80         ; 驱动器号为 0x80（第一个硬盘）
mov ax, 0x0000       ; 缓冲区段地址
mov es, ax           ; 设置段寄存器
mov bx, 0x8000       ; 偏移地址为 0x8000
int 0x13             ; 调用 BIOS 中断
jc ReadError         ; 如果出错，跳转到错误处理
```

#### 读取硬盘的前 5 个扇区：
```asm
mov ah, 0x02         ; 指定读取扇区功能
mov al, 0x05         ; 读取 5 个扇区
mov ch, 0x00         ; 柱面号（低 8 位），第 0 柱面
mov cl, 0x01         ; 扇区号为 1（从第 1 扇区开始）
mov dh, 0x00         ; 磁头号为 0（第 0 磁头）
mov dl, 0x80         ; 驱动器号为 0x80（第一个硬盘）
mov ax, 0x0000       ; 缓冲区段地址
mov es, ax           ; 设置段寄存器
mov bx, 0x8000       ; 偏移地址为 0x8000
int 0x13             ; 调用 BIOS 中断
jc ReadError         ; 如果出错，跳转到错误处理
```

---

### **总结**
- **`AL`** 是一次读取或写入操作所涉及的**扇区数量**。
- **`CL`（低 6 位）** 是开始操作的**扇区号**，决定从哪个扇区开始读取或写入数据。
- 这两者的结合允许程序灵活地控制磁盘操作，`CL` 定义操作的起点，而 `AL` 定义操作的范围（长度）。
